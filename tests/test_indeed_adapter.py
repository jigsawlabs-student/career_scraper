from bs4 import BeautifulSoup as bs
from src.adapters.indeed_adapter import *
import pdb

html_doc = """<a class="tapItem fs-unmask result job_47cc223fdaec3b16 resultWithShelf sponTapItem desktop" data-hide-spinner="true" data-hiring-event="false" data-jk="47cc223fdaec3b16" data-mobtk="1fsp164p6u1up801" href="/rc/clk?jk=47cc223fdaec3b16&amp;fccid=3ed0572c448b2368&amp;vjs=3" id="job_47cc223fdaec3b16" rel="nofollow" target="_blank"><div class="slider_container"><div class="slider_list"><div class="slider_item"><div class="job_seen_beacon"><table cellpadding="0" cellspacing="0" class="jobCard_mainContent big6_visualChanges" role="presentation"><tbody><tr><td class="resultContent"><div class="heading4 color-text-primary singleLineTitle tapItem-gutter"><h2 class="jobTitle jobTitle-color-purple"><span title="Data Engineer">Data Engineer</span></h2></div><div class="heading6 company_location tapItem-gutter companyInfo"><span class="companyName"><a class="turnstileLink companyOverviewLink" data-tn-element="companyName" href="/cmp/Intone-Networks" rel="noopener" target="_blank">Intone Networks</a></span><span class="ratingsDisplay withRatingLink"><a aria-label="Company rating 4.2 out of 5 stars" class="ratingLink" data-tn-variant="cmplinktst2" href="/cmp/Intone-Networks/reviews" rel="noopener" target="_blank" title="Intone Networks reviews"><span aria-label="4.2 of stars rating" class="ratingNumber" role="img"><span aria-hidden="true">4.2</span><svg aria-hidden="true" class="starIcon" fill="none" height="12" role="presentation" viewbox="0 0 16 16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M8 12.8709L12.4542 15.5593C12.7807 15.7563 13.1835 15.4636 13.0968 15.0922L11.9148 10.0254L15.8505 6.61581C16.1388 6.36608 15.9847 5.89257 15.6047 5.86033L10.423 5.42072L8.39696 0.640342C8.24839 0.289808 7.7516 0.289808 7.60303 0.640341L5.57696 5.42072L0.395297 5.86033C0.015274 5.89257 -0.13882 6.36608 0.149443 6.61581L4.0852 10.0254L2.90318 15.0922C2.81653 15.4636 3.21932 15.7563 3.54584 15.5593L8 12.8709Z" fill="#767676"></path></svg></span></a></span><div class="companyLocation"><span class="more_loc_container"><a aria-label="Same Data Engineer job in 2 other locations" class="more_loc" href="/addlLoc/redirect?tk=1fsp164p6u1up801&amp;jk=47cc223fdaec3b16&amp;dest=%2Fjobs%3Fq%3Ddata%2Bengineer%26l%3DUnited%2BStates%26explvl%3Dentry_level%26grpKey%3D8gcGdG5mdGNsuA%252BDqogBqhAaCglub3JtdGl0bGUaDWRhdGEgZW5naW5lZXI%253D" rel="nofollow">+2 locations</a></span><span>Remote</span></div></div><div class="heading6 tapItem-gutter metadataContainer noJEMChips salaryOnly"><div class="metadata"><div class="attribute_snippet"><svg aria-hidden="true" aria-label="Job type" fill="none" height="13" role="presentation" viewbox="0 0 14 13" width="14" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.50226.5c-.27614 0-.5.223858-.5.5v2.1H.5c-.276142 0-.5.22386-.5.5v1.9h14V3.6c0-.27614-.2239-.5-.5-.5h-3.4977V1c0-.276142-.22389-.5-.50004-.5h-5Zm4.19962 2.6H5.30344V1.8h3.39844v1.3Z" fill="#595959" fill-rule="evenodd"></path><path d="M5.70117 6.80005H0v5.20005c0 .2761.223857.5.5.5h13c.2761 0 .5-.2239.5-.5V6.80005H8.30117v.80322c0 .27614-.22386.5-.5.5h-1.6c-.27614 0-.5-.22386-.5-.5v-.80322Z" fill="#595959"></path></svg>Contract</div></div></div><div class="heading6 error-text tapItem-gutter"></div></td></tr></tbody></table><table class="jobCardShelfContainer big6_visualChanges" role="presentation"><tbody><tr class="jobCardShelf"></tr><tr class="underShelfFooter"><td><div class="heading6 tapItem-gutter result-footer"><div class="job-snippet"><ul style="list-style-type:circle;margin-top: 0px;margin-bottom: 0px;padding-left:20px;">
<li>SAP- First priority Informatica ICCS- 2nd Priority AWS Moving <b>data</b> from NetSuite to Redsuit.</li>
</ul></div><span class="date"><span class="visually-hidden">Posted</span>28 days ago</span><span class="result-link-bar-separator">Â·</span><button aria-expanded="false" class="sl resultLink more_links_button" type="button">More...</button></div><div class="tab-container"><div class="more-links-container result-tab" role="presentation"><div class="more_links"><button aria-label="Close" class="close-button" title="Close" type="button"></button><ul><li><span class="mat">View all <a href="/q-Intone-Networks-l-Remote-jobs.html">Intone Networks jobs in Remote</a> - <a href="/l-Remote-jobs.html">Remote jobs</a></span></li><li><span class="mat">Salary Search: <a href="/career/data-engineer/salaries?campaignid=serp-more&amp;fromjk=47cc223fdaec3b16&amp;from=serp-more">Data Engineer salaries in Remote</a></span></li></ul></div></div></div></td></tr></tbody></table><div aria-live="polite"></div></div></div><div class="slider_sub_item"></div></div></div><div class="kebabMenu"><button aria-expanded="false" aria-haspopup="true" aria-label="Job Actions" class="kebabMenu-button"><svg aria-hidden="true" fill="none" height="24" role="presentation" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7C13.1 7 14 6.1 14 5C14 3.9 13.1 3 12 3C10.9 3 10 3.9 10 5C10 6.1 10.9 7 12 7ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10ZM12 17C10.9 17 10 17.9 10 19C10 20.1 10.9 21 12 21C13.1 21 14 20.1 14 19C14 17.9 13.1 17 12 17Z" fill="#2d2d2d"></path></svg></button></div></a>"""


converse_job = """<a class="tapItem fs-unmask result job_f59aef6085566bb4 resultWithShelf sponTapItem desktop" data-hide-spinner="true" data-hiring-event="false" data-jk="f59aef6085566bb4" data-mobtk="1fsp298g1u3sj800" href="/rc/clk?jk=f59aef6085566bb4&amp;fccid=da04a6c5e0918194&amp;vjs=3" id="job_f59aef6085566bb4" rel="nofollow" target="_blank"><div class="slider_container"><div class="slider_list"><div class="slider_item"><div class="job_seen_beacon"><table cellpadding="0" cellspacing="0" class="jobCard_mainContent big6_visualChanges" role="presentation"><tbody><tr><td class="resultContent"><div class="heading4 color-text-primary singleLineTitle tapItem-gutter"><h2 class="jobTitle jobTitle-color-purple"><span title="Data Engineer (Open to remote work, except the following locations: SD, VT, and WV)">Data Engineer (Open to remote work, except the following loc...</span></h2></div><div class="heading6 company_location tapItem-gutter companyInfo"><span class="companyName"><a class="turnstileLink companyOverviewLink" data-tn-element="companyName" href="/cmp/Converse" rel="noopener" target="_blank">Converse</a></span><span class="ratingsDisplay withRatingLink"><a aria-label="Company rating 4 out of 5 stars" class="ratingLink" data-tn-variant="cmplinktst2" href="/cmp/Converse/reviews" rel="noopener" target="_blank" title="Converse reviews"><span aria-label="4.0 of stars rating" class="ratingNumber" role="img"><span aria-hidden="true">4.0</span><svg aria-hidden="true" class="starIcon" fill="none" height="12" role="presentation" viewbox="0 0 16 16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M8 12.8709L12.4542 15.5593C12.7807 15.7563 13.1835 15.4636 13.0968 15.0922L11.9148 10.0254L15.8505 6.61581C16.1388 6.36608 15.9847 5.89257 15.6047 5.86033L10.423 5.42072L8.39696 0.640342C8.24839 0.289808 7.7516 0.289808 7.60303 0.640341L5.57696 5.42072L0.395297 5.86033C0.015274 5.89257 -0.13882 6.36608 0.149443 6.61581L4.0852 10.0254L2.90318 15.0922C2.81653 15.4636 3.21932 15.7563 3.54584 15.5593L8 12.8709Z" fill="#767676"></path></svg></span></a></span><div class="companyLocation">Remote in Boston, MA</div></div><div class="heading6 tapItem-gutter metadataContainer noJEMChips salaryOnly"><div class="metadata salary-snippet-container"><div class="attribute_snippet"><svg aria-hidden="true" aria-label="Salary" fill="none" role="presentation" viewbox="0 0 16 13" xmlns="http://www.w3.org/2000/svg"><defs></defs><path clip-rule="evenodd" d="M2.45168 6.10292c-.30177-.125-.62509-.18964-.95168-.1903V4.08678c.32693-.00053.6506-.06518.95267-.1903.30331-.12564.57891-.30979.81105-.54193.23215-.23215.4163-.50775.54194-.81106.12524-.30237.18989-.62638.19029-.95365H9.0902c0 .3283.06466.65339.1903.9567.12564.30331.30978.57891.54193.81106.23217.23215.50777.41629.81107.54193.3032.12558.6281.19024.9562.1903v1.83556c-.3242.00155-.6451.06616-.9448.19028-.3033.12563-.5789.30978-.81102.54193-.23215.23214-.4163.50774-.54193.81106-.12332.2977-.18789.61638-.19024.93849H3.99496c-.00071-.32645-.06535-.64961-.19029-.95124-.12564-.30332-.30979-.57891-.54193-.81106-.23215-.23215-.50775-.4163-.81106-.54193zM0 .589843C0 .313701.223858.0898438.5.0898438h12.0897c.2762 0 .5.2238572.5.5000002V9.40715c0 .27614-.2238.5-.5.5H.5c-.276143 0-.5-.22386-.5-.5V.589843zM6.54427 6.99849c1.10457 0 2-.89543 2-2s-.89543-2-2-2-2 .89543-2 2 .89543 2 2 2zm8.05523-2.69917v7.10958H2.75977c-.27615 0-.5.2238-.5.5v.5c0 .2761.22385.5.5.5H15.422c.4419 0 .6775-.2211.6775-.6629V4.29932c0-.27615-.2239-.5-.5-.5h-.5c-.2761 0-.5.22385-.5.5z" fill="#595959" fill-rule="evenodd"></path></svg>$75,000 a year</div></div><div class="metadata"><div class="attribute_snippet"><svg aria-hidden="true" aria-label="Job type" fill="none" height="13" role="presentation" viewbox="0 0 14 13" width="14" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.50226.5c-.27614 0-.5.223858-.5.5v2.1H.5c-.276142 0-.5.22386-.5.5v1.9h14V3.6c0-.27614-.2239-.5-.5-.5h-3.4977V1c0-.276142-.22389-.5-.50004-.5h-5Zm4.19962 2.6H5.30344V1.8h3.39844v1.3Z" fill="#595959" fill-rule="evenodd"></path><path d="M5.70117 6.80005H0v5.20005c0 .2761.223857.5.5.5h13c.2761 0 .5-.2239.5-.5V6.80005H8.30117v.80322c0 .27614-.22386.5-.5.5h-1.6c-.27614 0-.5-.22386-.5-.5v-.80322Z" fill="#595959"></path></svg>Full-time</div></div></div><div class="heading6 error-text tapItem-gutter"></div></td></tr></tbody></table><table class="jobCardShelfContainer big6_visualChanges" role="presentation"><tbody><tr class="jobCardShelf"></tr><tr class="underShelfFooter"><td><div class="heading6 tapItem-gutter result-footer"><div class="job-snippet"><ul style="list-style-type:circle;margin-top: 0px;margin-bottom: 0px;padding-left:20px;">
<li style="margin-bottom:0px;">Understanding of <b>data</b> lake/data warehouse concepts, <b>data</b> modeling concepts.</li>
<li>Develop new <b>data</b> pipelines under the guidance of senior engineers.</li>
</ul></div><span class="date"><span class="visually-hidden">Posted</span>20 days ago</span><span class="result-link-bar-separator">Â·</span><button aria-expanded="false" class="sl resultLink more_links_button" type="button">More...</button></div><div class="tab-container"><div class="more-links-container result-tab" role="presentation"><div class="more_links"><button aria-label="Close" class="close-button" title="Close" type="button"></button><ul><li><span class="mat">View all <a href="/q-Converse-l-Boston,-MA-jobs.html">Converse jobs in Boston, MA</a> - <a href="/l-Boston,-MA-jobs.html">Boston jobs</a></span></li><li><span class="mat">Salary Search: <a href="/career/data-engineer/salaries/Boston--MA?campaignid=serp-more&amp;fromjk=f59aef6085566bb4&amp;from=serp-more">Data Engineer (Open to remote work, except the following locations: SD, VT, and WV) salaries in Boston, MA</a></span></li><li><span class="mat">See popular <a href="/cmp/Converse/faq">questions &amp; answers about Converse</a></span></li></ul></div></div></div></td></tr></tbody></table><div aria-live="polite"></div></div></div><div class="slider_sub_item"></div></div></div><div class="kebabMenu"><button aria-expanded="false" aria-haspopup="true" aria-label="Job Actions" class="kebabMenu-button"><svg aria-hidden="true" fill="none" height="24" role="presentation" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7C13.1 7 14 6.1 14 5C14 3.9 13.1 3 12 3C10.9 3 10 3.9 10 5C10 6.1 10.9 7 12 7ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10ZM12 17C10.9 17 10 17.9 10 19C10 20.1 10.9 21 12 21C13.1 21 14 20.1 14 19C14 17.9 13.1 17 12 17Z" fill="#2d2d2d"></path></svg></button></div></a>
"""

html_doc = bs(converse_job, 'html.parser')
card = html_doc.find('a')

def test_get_id_gets_id():
    indeed_adapter = IndeedAdapter(card)
    id = indeed_adapter.get_id()
    assert id == "f59aef6085566bb4"

def test_get_title():
    indeed_adapter = IndeedAdapter(card)
    assert indeed_adapter.get_title() == "Data Engineer"

def test_get_salaries():
    indeed_adapter = IndeedAdapter(card)
    return indeed_adapter.get_salaries()

def test_get_description():
    indeed_adapter = IndeedAdapter(card)
    # description = indeed_adapter.get_description()
    test_desc = '<p>Data Reporting Engineering Contractor, you will work with the data-engineering team to build and enhance partner and client reports using pyspark, spark/scala, and AWS EMR, S3, and snowflake. Includes Development, testing, and validatio</p><p>Job Type: Full-time</p><p>Salary: Up to $180,000.00 per year</p><p>Schedule:</p><ul><li>8 hour shift</li></ul><p>Work Remotely:</p><ul><li>Yes</li></ul>'
    assert description == test_desc

def test_get_company_name():
    indeed_adapter = IndeedAdapter(card)
    assert indeed_adapter.get_company_name() == "Converse"

def test_get_city_state():
    indeed_adapter = IndeedAdapter(card)
    city, state = indeed_adapter.get_city_state()
    assert city == 'Boston'
    assert state == 'MA'

def test_run_adapter():
    indeed_adapter = IndeedAdapter(card)
    # position = indeed_adapter.run()
    obj_keys = ['id', 'title', 'salaries', 'description', 'city', 'state',
     'company_name', 'location_text', 'remote']
    obj_vals = ['0601c9a2ee3bd7d2', 'Data Engineer', [75000], 
    '<p>Data Reporting Engineering Contractor, you will work with the data-engineering team to build and enhance partner and client reports using pyspark, spark/scala, and AWS EMR, S3, and snowflake. Includes Development, testing, and validatio</p><p>Job Type: Full-time</p><p>Salary: Up to $180,000.00 per year</p><p>Schedule:</p><ul><li>8 hour shift</li></ul><p>Work Remotely:</p><ul><li>Yes</li></ul>',
     'Boston', 'MA', 'Spanidea Systemms']
    vals = list(vars(position).values())
    keys = list(vars(position).keys())
    assert obj_keys == keys
    assert obj_vals == vals
    
    


